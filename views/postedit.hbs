<div class="max-w-4xl mx-auto  p-4 md:p-8">

  <div class="card bg-base-100 shadow-xl border border-base-300">

    <div class=" px-4 sm:px-8 pt-8 pb-2">
      <h2 class="text-3xl font-bold text-base-content">
        {{#if docreate}}Create New Post{{else}}Edit Post{{/if}}
      </h2>
      <p class="text-base-content/60 mt-1">Fill out the details below to save your post.</p>
    </div>

    <form id="postForm" class="card-body gap-4 p-4 sm:p-8" method='POST' action='/posts/save'>

      {{#if docreate}}
      <input type='hidden' name='docreate' value="create">
      {{else}}
      <input type='hidden' name='docreate' value="update">
      <input type='hidden' name='postkey' value='{{#if post }}{{postkey}}{{/if}}' />
      {{/if}}
      <div class="w-full">
        <h3 class=" font-semibold text-secondary">Add Categories (Atlest One)</h3>
        <div id="catgDiv" class=" grid  grid-cols-1 sm:grid-cols-3 ">
          <label class="  flex items-baseline gap-2 py-1">First
            <select name="catg1" id="catg1" required="" class=" select w-36 px-8 select-primary">
              <option value="" selected disabled="">pick one</option>
            {{#each catgNameList}}
              <option>{{catgName}}</option>
            {{/each}}
            </select>
          </label> 
        </div>
      </div>
      <div class=" w-full">
        <label class="label" for="title">
          <span class=" font-semibold text-secondary">Title</span>
        </label>
        <input required id="title" type='text' name='title' value='{{#if post }}{{post.title}}{{/if}}'
          class="input input-bordered w-full text-lg font-bold focus:input-primary transition-all"
          placeholder="Enter a descriptive title" />
      </div>

      <div class=" w-full">
        <label class=" label" for="body">
          <span class=" font-semibold text-secondary">Content</span>
        </label>
        <input required id="x" type="hidden" name="body">
        <trix-toolbar class=" md:mr-4  mb-1 mt-2" id="my_toolbar"></trix-toolbar>
        <trix-editor toolbar="my_toolbar" input="x" class=" prose max-w-full ">{{#if post
          }}{{{post.body}}}{{/if}}</trix-editor>
      </div>

      <div class="card-actions justify-end mt-4 flex items-center gap-4">
        <a href="/" class="btn btn-ghost">Cancel</a>

        <button id="submit" type='submit' class="btn btn-primary px-8 gap-2">
          <span>{{#if docreate}}Publish Post{{else}}Save Changes{{/if}}</span>
          <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
          </svg>
        </button>
      </div>

    </form>
  </div>
</div>
<script>
  const observer = new MutationObserver((mutations, obs) => {
    const fileToolbar = document.querySelector(".trix-button-group--file-tools")
    if (fileToolbar) {
      fileToolbar.remove()
      obs.disconnect()
    }
  })
  observer.observe(document.body, {
    childList: true,
    subtree: true
  })
  class Categoreis {

    constructor(catgsList) {
      this.parent = document.getElementById("catgDiv")
      this.catgsList = catgsList
      this.addEvents()
    }
    createSelector(lableText, name) {
      const label = document.createElement("label");
      label.className = "  flex items-baseline gap-2 py-1"
      const select = document.createElement("select");
      label.appendChild(document.createTextNode(lableText));
      label.appendChild(select)
      this.parent.appendChild(label)

      select.name = name;
      select.id = name;
      if (name === "catg1") select.required = true;
      select.className = " select w-36 px-8 select-primary"
      /** @type {String[]} */
      const catgsList = this.catgsList;

      catgsList.map((c, i) => {

        const option = document.createElement("option")
        option.textContent = c
        if (i === 0) {
          option.selected = true
          option.value = ""
          option.disabled = true
        }
        select.appendChild(option)
      })
    }
    async fetchCatgsNames() {
      const res = await fetch("/posts/categories-names-list")
      return res.json();
    }
    addEvents() {
      const select1 = document.getElementById("catg1")


      const listner1 = async (e) => {
        await this.createSelector("2nd", "catg2")
        select1.removeEventListener("change", listner1);

        const listner2 = async (e) => {
          await this.createSelector("3rd", "catg3")
          select2.removeEventListener("change", listner2)
        }

        const select2 = document.getElementById("catg2");
        select2.addEventListener("change", listner2)



      }
      select1.addEventListener("change", listner1)
    }
  }
  const submit = document.getElementById("submit");
  submit.disabled = true
  window.onload = async () => {
    const catgsList = await fetch("/posts/categories-names-list").then(res => res.json());
{{#if docreate}}
    new Categoreis(["pick one", ...catgsList])
{{/if}}
    submit.disabled = false
  }
</script>