generator client {
  provider = "prisma-client"
  output   = "./generated/prisma"
}

datasource db {
  provider = "postgresql"
}

model postUser {
  id              String     @id @unique
  username        String     @unique @db.VarChar(255)
  provider        String     @db.VarChar(255)
  displayName     String     @db.VarChar(255)
  firstName       String?    @db.VarChar(255)
  lastName        String?    @db.VarChar(255)
  email           String?    @db.VarChar(255)
  about           String?    @db.Text
  photo           Bytes?
  photoType       String?    @db.VarChar(255)
  photo_updatedAt DateTime?  @updatedAt @db.Timestamptz(6)
  likes           like[]
  posts           posts[]
  comments        comments[]
  sessions        session[]
}

model like {
  post    posts    @relation(fields: [postkey], references: [key], onDelete: Cascade)
  postkey String
  likedby postUser @relation(fields: [userId], references: [id], onDelete: Cascade)
  userId  String

  @@id([postkey, userId])
  @@index([userId])
}

model categories {
  id   Int    @id @default(autoincrement())
  name String @db.VarChar(255) @unique

  categoryToPosts categoryToPosts[]
}

model categoryToPosts {
  postkey  String
  catgName String
  post     posts      @relation(fields: [postkey], references: [key], onDelete: Cascade)
  category categories @relation(fields: [catgName], references: [name], onDelete: Cascade)
  createdAt DateTime  @db.Timestamptz(6) @default(now())
  
  @@id([catgName, postkey])
  @@index([postkey])
}

model posts {
  title     String?           @db.VarChar(255)
  body      String?
  createdAt DateTime          @default(now()) @db.Timestamptz(6)
  updatedAt DateTime          @updatedAt @db.Timestamptz(6)
  likes     like[]
  public    Boolean           @default(true)
  autherId  String            @db.VarChar(255)
  key       String            @id @db.VarChar(255)
  auther    postUser          @relation(fields: [autherId], references: [id], onDelete: Cascade)
  comments  comments[]
  catgs categoryToPosts[]

  @@index([autherId])
  @@index([autherId, public])
  @@index([updatedAt(sort: Desc), key])
}

model comments {
  id        Int      @id @default(autoincrement())
  body      String   @db.VarChar(1024)
  createdAt DateTime @default(now()) @db.Timestamptz(6)
  postkey   String   @db.VarChar(255)
  autherId  String
  auther    postUser @relation(fields: [autherId], references: [id], onDelete: Cascade)
  post      posts    @relation(fields: [postkey], references: [key], onDelete: Cascade)

  @@index([postkey, createdAt(sort: Desc)])
  @@index([autherId])
}

model session {
  id     String   @id
  user   postUser @relation(fields: [userId], references: [id], onDelete: Cascade)
  userId String
  expire DateTime @db.Timestamp(6)

  @@index([expire], map: "IDX_session_expire")
}
